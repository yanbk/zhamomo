var loadingData = [
		{name : "background", path : "./img/bg.jpg?v=1"},
	];
var imgData = [
		{name : "player-0", path : "./img/hero_rongmomozhaziwei-animation_0.png"}, 
		{name : "player-1", path : "./img/hero_rongmomozhaziwei-animation_1.png"}, 
		{name : "player-2", path : "./img/hero_rongmomozhaziwei-animation_2.png"}, 
		{name : "player-3", path : "./img/hero_rongmomozhaziwei-animation_3.png"}, 
		{name : "player-4", path : "./img/hero_rongmomozhaziwei-animation_4.png"}, 
		{name : "player-5", path : "./img/hero_rongmomozhaziwei-animation_5.png"}, 
		{name : "player-6", path : "./img/hero_rongmomozhaziwei-animation_6.png"}, 
		{name : "player-7", path : "./img/hero_rongmomozhaziwei-animation_7.png"}, 
		{name : "player-8", path : "./img/hero_rongmomozhaziwei-animation_8.png"}, 
		{name : "player-9", path : "./img/hero_rongmomozhaziwei-animation_9.png"}, 
		{name : "player-10", path : "./img/hero_rongmomozhaziwei-animation_10.png"}, 
		{name : "player-11", path : "./img/hero_rongmomozhaziwei-animation_11.png"}, 
		{name : "player-12", path : "./img/hero_rongmomozhaziwei-animation_12.png"}, 
		{name : "player-13", path : "./img/hero_rongmomozhaziwei-animation_13.png"}, 
		{name : "player-14", path : "./img/hero_rongmomozhaziwei-animation_14.png"}, 
		{name : "player-15", path : "./img/hero_rongmomozhaziwei-animation_15.png"}, 
		{name : "player-16", path : "./img/hero_rongmomozhaziwei-animation_16.png"}, 
		{name : "player-17", path : "./img/hero_rongmomozhaziwei-animation_17.png"}, 
		{name : "player-18", path : "./img/hero_rongmomozhaziwei-animation_18.png"}, 
		{name : "player-19", path : "./img/hero_rongmomozhaziwei-animation_19.png"}, 
		{name : "player-20", path : "./img/hero_rongmomozhaziwei-animation_20.png"}, 
		{name : "player-21", path : "./img/hero_rongmomozhaziwei-animation_21.png"}, 
		{name : "player-22", path : "./img/hero_rongmomozhaziwei-animation_22.png"}, 
		{name : "player-23", path : "./img/hero_rongmomozhaziwei-animation_23.png"}, 
		{name : "player-24", path : "./img/hero_rongmomozhaziwei-animation_24.png"}, 
		{name : "player-25", path : "./img/hero_rongmomozhaziwei-animation_25.png"}, 
		{name : "player-26", path : "./img/hero_rongmomozhaziwei-animation_26.png"}, 
		{name : "player-27", path : "./img/hero_rongmomozhaziwei-animation_27.png"}, 
		{name : "player-28", path : "./img/hero_rongmomozhaziwei-animation_28.png"}, 
		{name : "player-29", path : "./img/hero_rongmomozhaziwei-animation_29.png"}, 
		{name : "player-30", path : "./img/hero_rongmomozhaziwei-animation_30.png"}, 
		{name : "player-31", path : "./img/hero_rongmomozhaziwei-animation_31.png"}, 
		{name : "player-32", path : "./img/hero_rongmomozhaziwei-animation_32.png"}, 
		{name : "player-33", path : "./img/hero_rongmomozhaziwei-animation_33.png"}, 
		{name : "player-34", path : "./img/hero_rongmomozhaziwei-animation_34.png"}, 
		{name : "player-35", path : "./img/hero_rongmomozhaziwei-animation_35.png"}, 
		{name : "player-36", path : "./img/hero_rongmomozhaziwei-animation_36.png"}, 
		{name : "player-37", path : "./img/hero_rongmomozhaziwei-animation_37.png"}, 
		{name : "player-38", path : "./img/hero_rongmomozhaziwei-animation_38.png"}, 
		{name : "player-39", path : "./img/hero_rongmomozhaziwei-animation_39.png"}, 
		{name : "player-40", path : "./img/hero_rongmomozhaziwei-animation_40.png"}, 
		{name : "player-41", path : "./img/hero_rongmomozhaziwei-animation_41.png"}, 
		{name : "player-42", path : "./img/hero_rongmomozhaziwei-animation_42.png"}, 
		{name : "player-43", path : "./img/hero_rongmomozhaziwei-animation_43.png"}, 
		{name : "player-44", path : "./img/hero_rongmomozhaziwei-animation_44.png"}, 
		{name : "player-45", path : "./img/hero_rongmomozhaziwei-animation_45.png"}, 
		{name : "player-46", path : "./img/hero_rongmomozhaziwei-animation_46.png"},
		{name : "player1-0", path : "./img/rongmomozhaziwei-animation_0.png"}, 
		{name : "player1-1", path : "./img/rongmomozhaziwei-animation_1.png"}, 
		{name : "player1-2", path : "./img/rongmomozhaziwei-animation_2.png"}, 
		{name : "player1-3", path : "./img/rongmomozhaziwei-animation_3.png"}, 
		{name : "player1-4", path : "./img/rongmomozhaziwei-animation_4.png"}, 
		{name : "player1-5", path : "./img/rongmomozhaziwei-animation_5.png"}, 
		{name : "player1-6", path : "./img/rongmomozhaziwei-animation_6.png"}, 
		{name : "player1-7", path : "./img/rongmomozhaziwei-animation_7.png"}, 
		{name : "player1-8", path : "./img/rongmomozhaziwei-animation_8.png"}, 
		{name : "player1-9", path : "./img/rongmomozhaziwei-animation_9.png"}, 
		{name : "player1-10", path : "./img/rongmomozhaziwei-animation_10.png"}, 
		{name : "player1-11", path : "./img/rongmomozhaziwei-animation_11.png"}, 
		{name : "player1-12", path : "./img/rongmomozhaziwei-animation_12.png"}, 
		{name : "player1-13", path : "./img/rongmomozhaziwei-animation_13.png"}, 
		{name : "player1-14", path : "./img/rongmomozhaziwei-animation_14.png"}, 
		{name : "player1-15", path : "./img/rongmomozhaziwei-animation_15.png"}, 
		{name : "player1-16", path : "./img/rongmomozhaziwei-animation_16.png"}, 
		{name : "player1-17", path : "./img/rongmomozhaziwei-animation_17.png"}, 
		{name : "player1-18", path : "./img/rongmomozhaziwei-animation_18.png"}, 
		{name : "player1-19", path : "./img/rongmomozhaziwei-animation_19.png"}, 
		{name : "player1-20", path : "./img/rongmomozhaziwei-animation_20.png"}, 
		{name : "player1-21", path : "./img/rongmomozhaziwei-animation_21.png"}, 
		{name : "player1-22", path : "./img/rongmomozhaziwei-animation_22.png"}, 
		{name : "player1-23", path : "./img/rongmomozhaziwei-animation_23.png"}, 
		{name : "player1-24", path : "./img/rongmomozhaziwei-animation_24.png"},

		{name : "bg", path : "./img/bg.jpg?v=1"},
		{name : "jump", path : "./img/jump.png"},
		{name : "rongmomo", path : "./img/rongmomo.png"},
		{name : "wz_bg", path : "./img/wz_bg.png"},
		{name : "zw", path : "./img/ziwei.png"},
		{name : "bg1", path : "./img/bg1.jpg"},
		{name : "slogan", path : "./img/slogan.png"},
		{name : "paihang", path : "./img/paihang.png"},
		{name : "zharmmbtn", path : "./img/zharmmbtn.png"},
		{name : "bg2", path : "./img/bg2.jpg"},
		{name : "rmm1", path : "./img/rmm1.png"},
		{name : "rmm2", path : "./img/rmm2.png"},
		{name : "rmm3", path : "./img/rmm3.png"},
		{name : "hand1", path : "./img/hand1.png?v=1"},
		{name : "hand2", path : "./img/hand2.png?v=1"},
		{name : "wz1", path : "./img/wz1.png"},
		{name : "wz2", path : "./img/wz2.png"},
		{name : "wz3", path : "./img/wz3.png"},
		{name : "wz4", path : "./img/wz4.png"},
		{name : "wz5", path : "./img/wz5.png"},
		{name : "wz6", path : "./img/wz6.png"},
		{name : "djs", path : "./img/djs.png"},
		{name : "startbtn", path : "./img/startbtn.png"},
		{name : "tan", path : "./img/tan.png?v=2"},
		{name : "lqbtn", path : "./img/lqbtn.png"},
		{name : "bg3", path : "./img/bg3.jpg"},
		{name : "logo1", path : "./img/logo1.png"},
		{name : "again_btn", path : "./img/again_btn.png"},
		{name : "gx", path : "./img/gx.png"},
		{name : "bx", path : "./img/bx.png"},
		{name : "lb1", path : "./img/lb1.png"},
		{name : "lb2", path : "./img/lb2.png"},
		{name : "lb3", path : "./img/lb3.png"},
		{name : "lb4", path : "./img/lb4.png"},
		{name : "lb5", path : "./img/lb5.png"},
		{name : "lb6", path : "./img/lb6.png"},
		{name : "sharebtn", path : "./img/sharebtn.png?v=1"},
		{name : "share", path : "./img/share.png"},
		{name : "back", path : "./img/back.png"},
		{name : "pm_title", path : "./img/pm_title.png"},
		{name : "no1", path : "./img/no1.png"},
		{name : "no2", path : "./img/no2.png"},
		{name : "no3", path : "./img/no3.png"},
		{name : "ziwei1", path : "./img/ziwei1.png"},
		{name : "ziwei2", path : "./img/ziwei2.png"},
		{name : "tan1", path : "./img/tan1.png"},
	];
	var loadingLayer,backLayer,imglist,actlist,
		rmmzwLayer,jumpLayer,zharmmLayer,handLayer,
		djsLayer,rmmwzLayer,startbtnLayer,tanLayer,
		againLayer,inputLayer,sendLayer,sharebtnLayer,
		shareLayer,ruleLayer,ranklistbtnLayer,sharepageLayer,rulepageLayer,ranklistLayer;
	var bgmusic,rmmmusic,rmmzwmusic,zharmm,lastmusic,zwmusic;
	var rate;
	var placeHolder,inputnum;
	var myTimer,djsTimer;
	var userlist;
	var timeline=219; //219倒计时
	// var timeline=2;
	var ww=window.innerWidth;
	var hh=window.innerHeight;
	var scaleRate=640/ww*hh/1136;
	var theTextField;
	var persons=12345; //第多少位
	var timernum=3;  //3秒倒计时
	var linewidth=0; //进度条的宽度
	var zhanum=0;  //扎容嬷嬷的次数
	var zhatotal=1234; //总共扎的次数
	var lbnum=1;  //第几个礼包
	var is_rmm=true;
	var ranknum=1;
	var lbtextarr=["香妃的“肚兜”","容嬷嬷的“24K纯金针”","萧剑的“玉箫”","赛亚公主的“鞭子”","尔康的“鼻毛剪”","皇阿玛的“黄马褂”"];
	LInit(50, "legend", 800, 450, main);
	function main() {
		if (LGlobal.mobile) {
			rate=window.innerHeight / window.innerWidth;
            LGlobal.width = 640;
            LGlobal.height = 640 * rate;
            LGlobal.canvasObj.width = LGlobal.width;
            LGlobal.canvasObj.height = LGlobal.height;
        }
        LGlobal.preventDefault=false;
        LGlobal.align = LStageAlign.TOP_LEFT;
        LGlobal.stageScale = LStageScaleMode.SHOW_ALL;
        LSystem.screen(LStage.FULL_SCREEN);
		LLoadManage.load(loadingData, function (progress) {
			
		}, loadingImg);

		if(!LSound.webAudioEnabled){
			alert("不支持webAudioEnabled");
			return false;
		}
	}
	function loadingImg(result){
		actlist=result;
		loadingLayer = new LoadingSample4(LGlobal.height * 0.5, "#000", "#f6f6f6", result);
        addChild(loadingLayer);
        LLoadManage.load(imgData,
		function (progress) {
		    loadingLayer.setProgress(progress);
		}, gameInit);
	}
	function gameInit(result) {
		bgmusic = document.getElementById("bgmusic"); 
        rmmmusic= document.getElementById("rmmmusic"); 
        rmmzwmusic= document.getElementById("rmmzwmusic"); 
        zharmm= document.getElementById("zharmm"); 
        lastmusic= document.getElementById("lastmusic"); 
        zwmusic= document.getElementById("zwmusic"); 

        // bgmusic.play();

        var u = navigator.userAgent;
        console.log(u);

		imglist=result;
		loadingLayer.removeAllChild();
        removeChild(loadingLayer);
        loadingLayer = null;

        backLayer = new LSprite();
    	addChild(backLayer);
		
    	zhaLayer = new LSprite();
    	addChild(zhaLayer);

    	rmmzwLayer = new LSprite();
    	addChild(rmmzwLayer);

    	wzLayer = new LSprite();
    	addChild(wzLayer);

    	jumpLayer = new LSprite();
    	addChild(jumpLayer);

    	zharmmLayer=new LSprite();
		addChild(zharmmLayer);

		handLayer=new LSprite();
		addChild(handLayer);

		djsLayer=new LSprite();
		addChild(djsLayer);

		rmmwzLayer=new LSprite();
		addChild(rmmwzLayer);

		startbtnLayer=new LSprite();
		addChild(startbtnLayer);

		tanLayer=new LSprite();
		addChild(tanLayer);

		againLayer=new LSprite();
		addChild(againLayer);

		inputLayer=new LSprite();
		addChild(inputLayer);

		sendLayer=new LSprite();
		addChild(inputLayer);

		sharebtnLayer=new LSprite();
		addChild(sharebtnLayer);

		shareLayer=new LSprite();
		addChild(shareLayer);

		ruleLayer=new LSprite();
		addChild(ruleLayer);

		ranklistbtnLayer=new LSprite();
		addChild(ranklistbtnLayer);

		sharepageLayer=new LSprite();
		addChild(sharepageLayer);

		rulepageLayer=new LSprite();
		addChild(rulepageLayer);

		ranklistLayer=new LSprite();
		addChild(ranklistLayer);

		pagehome();

	}
	function pagehome(){
		backLayer.removeAllChild();
		zhaLayer.removeAllChild();
		rmmzwLayer.removeAllChild();
		wzLayer.removeAllChild();
		jumpLayer.removeAllChild();
		zharmmLayer.removeAllChild();
		handLayer.removeAllChild();
		rmmwzLayer.removeAllChild();
		startbtnLayer.removeAllChild();
		tanLayer.removeAllChild();
		againLayer.removeAllChild();
		inputLayer.removeAllChild();

		var bg=new LBitmap(new LBitmapData(imglist["bg"]));
		backLayer.addChild(bg);

		var list = LGlobal.divideCoordinate(18262, 370, 1, 46);
		var data = new LBitmapData(imglist["player-0"], 0, 0, 397, 370);
		var datas = [];
		var listChild = [];
		for (var i = 0; i < 46; i++) {
			datas.push(new LBitmapData(imglist["player-" + (i + 1)]));
			listChild.push({dataIndex : i, x : 0, y : 0, width : 397, height : 370, sx : 0, sy : 0});
		}
		var zhaactive = new LAnimationTimeline(datas, [listChild]);
		zhaactive.x = 150;
		zhaactive.y = 350;
		zhaactive.scaleX = 0.8;
		zhaactive.scaleY = 0.8;
		zhaLayer.addChild(zhaactive);

		var startbtn1=new LBitmap(new LBitmapData(imglist["startbtn"]));
		startbtn1.x=(640-startbtn1.getWidth()*0.1)/2,
		startbtn1.y=800-startbtn1.getWidth()*0.1/2,
		startbtn1.alpha=0;
		startbtnLayer.addChild(startbtn1);
		LTweenLite.to(startbtn1,0,{
			scaleX:0.1,
			scaleY:0.1,
			loop:true,
			alpha:1,
			x:(640-startbtn1.getWidth()*0.1)/2,
			y:800-startbtn1.getWidth()*0.1/2,
			ease:LEasing.None.easeOut
		}).to(startbtn1,1,{
			scaleX:2,
			scaleY:2,
			x:(640-startbtn1.getWidth()*2)/2,
			y:800-startbtn1.getWidth()*2/2,
			alpha:0,
			loop:true,
			ease:LEasing.None.easeOut
		});

		// rmmzwmusic = new LSound();
		startbtnLayer.addEventListener(LMouseEvent.MOUSE_DOWN,onup);

		var jumpbtn=new LBitmap(new LBitmapData(imglist["jump"]));
		jumpbtn.x=500;
		jumpbtn.y=50;
		jumpLayer.addChild(jumpbtn);
		jumpLayer.setChildIndex(jumpbtn,9999);
		jumpLayer.addEventListener(LMouseEvent.MOUSE_DOWN,page2);

	}
	// function onup(){
	// 	

	// 	rmmzwmusic.load("./audio/rmmzwmusic.mp3");
	//     rmmzwmusic.addEventListener(LEvent.COMPLETE,playstory);
	// }
	function onup(){
		bgmusic.play();
		rmmzwmusic.play();
		var musicTimer=setInterval(function(){
			if(rmmzwmusic.currentTime>0){
				clearInterval(musicTimer);
				playstory();
			}else{
				return false;
			}
		},30);
	}
	function playstory(){removeChild(startbtnLayer);
		// rmmzwmusic.play();
		bgmusic.play();
		// rmmzwmusic.removeEventListener(LMouseEvent.MOUSE_DOWN,playstory);
		var rmm=new LBitmap(new LBitmapData(imglist["rongmomo"]));
		rmm.x=640;
		rmm.y=640/ww*hh-543*scaleRate;
		rmm.scaleX=scaleRate,
        rmm.scaleY=scaleRate,
		rmmzwLayer.addChild(rmm);
		LTweenLite.to(rmm,0,{
            ease: LEasing.None.easeOut
        }).to(rmm, 0.2, {
            x: 640-269*scaleRate,
            delay:1,
            ease: LEasing.None.easeOut
        }).to(rmm,0.2,{
        	delay:5,
        	x:640,
        	ease: LEasing.None.easeOut,
        	onComplete:function(){
	        	wzLayer.removeChild(theTextField);
	        	theTextField = new LTextField();
				theTextField.text = "~啊~啊~";
				theTextField.font = "微软雅黑";
				theTextField.size=26;
				theTextField.color = "#FFFFFF";
				theTextField.x = 10;
				theTextField.y = 640/ww*hh-151*scaleRate+(151*scaleRate-theTextField.getHeight())/2;
				wzLayer.addChild(theTextField);
	        }
        }).to(rmm,0.2,{
        	delay:2.2,
        	x:640-269*scaleRate,
        	ease: LEasing.None.easeOut,
        	onComplete:function(){
	        	wzLayer.removeChild(theTextField);
	        	theTextField = new LTextField();
				theTextField.text = "今天你不老实交代，你这漂亮的小脸蛋，就没有了！";
				theTextField.font = "微软雅黑";
				theTextField.size=24;
				theTextField.color = "#FFFFFF";
				theTextField.x = 10;
				theTextField.y = 640/ww*hh-151*scaleRate+(151*scaleRate-theTextField.getHeight())/2;
				wzLayer.addChild(theTextField);
	        }
        }).to(rmm,0.2,{
        	delay:7.5,
        	x:640,
        	ease: LEasing.None.easeOut,
        	onComplete:function(){
				page2();
	        }
        });

        var wz_bg=new LBitmap(new LBitmapData(imglist["wz_bg"]));
		wz_bg.x=0;
		wz_bg.y=1136;
		wzLayer.addChild(wz_bg);
		LTweenLite.to(wz_bg,0.5,{
			delay:1,
			x:0,
			y:640/ww*hh-151*scaleRate,
			ease:LEasing.None.easeOut
		});
        
        theTextField = new LTextField();
		theTextField.text = "告诉我，是谁派你来勾引皇上的？说！";
		theTextField.font = "微软雅黑";
		theTextField.size=26;
		theTextField.color = "#FFFFFF";
		theTextField.x = 10;
		theTextField.y = 1136;
		wzLayer.addChild(theTextField);
		LTweenLite.to(theTextField,0.5,{
			delay:1,
			x:0,
			y:640/ww*hh-151*scaleRate+(151*scaleRate-theTextField.getHeight())/2,
			ease:LEasing.None.easeOut
		});

		var zw=new LBitmap(new LBitmapData(imglist["zw"]));
		zw.x=-513*scaleRate;
		zw.y=640/ww*hh-543*scaleRate;
		zw.scaleX=scaleRate,
        zw.scaleY=scaleRate,
		rmmzwLayer.addChild(zw);
		LTweenLite.to(zw,0,{
			delay:6.2,
            ease: LEasing.None.easeOut
        }).to(zw, 0.2, {
            x: 0,
            ease: LEasing.None.easeOut
        })
        .to(zw,0.2,{
        	delay:2.2,
        	scaleX:0.9,
        	scaleY:0.9,
        	x:0,
        	y:640/ww*hh-543*scaleRate*0.9,
        	ease: LEasing.None.easeOut
        }).to(zw,0.2,{
        	delay:7.5,
        	x:-513*scaleRate,
        	ease: LEasing.None.easeOut,
        	onComplete:function(){
				page2();
	        }
        });
	}
	function page2(){
		LTweenLite.pauseAll();
		// console.log(rmmzwmusic);
		if (rmmzwmusic.played) {
			rmmzwmusic.pause();
		}
		rmmzwmusic.pause();
		startbtnLayer.removeAllChild();
		bgmusic.play();
		wzLayer.removeAllChild();
		rmmzwLayer.removeAllChild();
		backLayer.removeAllChild();
		zhaLayer.removeAllChild();
		jumpLayer.removeAllChild();

		var bg1=new LBitmap(new LBitmapData(imglist["bg1"]));
		backLayer.addChild(bg1);
		var slogan=new LBitmap(new LBitmapData(imglist["slogan"]));
		slogan.x=50;
		slogan.y=100;
		backLayer.addChild(slogan);

		var paihang=new LBitmap(new LBitmapData(imglist["paihang"]));
		paihang.x=(640-paihang.getWidth())/2;
		paihang.y=330;
		backLayer.addChild(paihang);

		theTextField = new LTextField();
		theTextField.text = persons;
		theTextField.font = "宋体";
		theTextField.size=34;
		theTextField.color = "#FF0000";
		theTextField.x = (640-paihang.getWidth()+90-theTextField.getWidth())/2+60;
		theTextField.y = 327;
		wzLayer.addChild(theTextField);

		var list1 = LGlobal.divideCoordinate(13632, 619, 1, 24);
		var data1 = new LBitmapData(imglist["player1-0"], 0, 0, 568, 619);
		var datas1 = [];
		var listChild1 = [];
		for (var i = 0; i < 24; i++) {
			datas1.push(new LBitmapData(imglist["player1-" + (i + 1)]));
			listChild1.push({dataIndex : i, x : 0, y : 0, width : 568, height : 619, sx : 0, sy : 0});
		}
		var zhaactive1 = new LAnimationTimeline(datas1, [listChild1]);
		zhaactive1.scaleX = scaleRate;
		zhaactive1.scaleY = scaleRate;
		zhaactive1.x = 50;
		zhaactive1.y = 640/ww*hh-zhaactive1.getHeight();
		zhaLayer.addChild(zhaactive1);

		var zharmmbtn=new LBitmap(new LBitmapData(imglist["zharmmbtn"]));
		zharmmbtn.scaleX = scaleRate;
		zharmmbtn.scaleY = scaleRate;
		zharmmbtn.x=(640-zharmmbtn.getWidth())/2;
		zharmmbtn.y=640/ww*hh-zharmmbtn.getHeight()-40;
		zharmmLayer.addChild(zharmmbtn);

		zharmmLayer.addEventListener(LMouseEvent.MOUSE_DOWN,page3);
	}
	function page3(){
		wzLayer.removeAllChild();
		backLayer.removeAllChild();
		zhaLayer.removeAllChild();
		zharmmLayer.removeAllChild();
		zharmmLayer.removeEventListener(LMouseEvent.MOUSE_DOWN,page3);

		bgmusic.pause();
		zharmm.play();

		var bg2=new LBitmap(new LBitmapData(imglist["bg2"]));
		backLayer.addChild(bg2);

		var rmm;
		if(is_rmm){
			rmm=new LBitmap(new LBitmapData(imglist["rmm1"]));
		}else{
			rmm=new LBitmap(new LBitmapData(imglist["ziwei1"]));
		}
		rmm.scaleX = scaleRate;
		rmm.scaleY = scaleRate;
		rmm.x=(640-rmm.getWidth())/2;
		rmm.y=250;
		zharmmLayer.addChild(rmm);

		var hand1=new LBitmap(new LBitmapData(imglist["hand1"]));
		hand1.scaleX = scaleRate;
		hand1.scaleY = scaleRate;
		hand1.x=(640-hand1.getWidth())/2;
		hand1.y=640/ww*hh-hand1.getHeight()-40;
		handLayer.addChild(hand1);

		myTimer = new LTimer(1000, 3);
		myTimer.addEventListener(LTimerEvent.TIMER, timerHandler);
		myTimer.start();
		
		function timerHandler(){
			var timer = new LTextField();
			timer.text = timernum;
			timer.font = "微软雅黑";
			timer.size=100;
			timer.fontWeight="bold";
			timer.color = "#FFFFFF";
			timer.stroke = true;
			timer.lineWidth = 2;
			timer.lineColor = "#FFFFFF";
			timer.x = (640-timer.getWidth())/2;
			timer.y = 250+rmm.getHeight()/3-timer.getHeight()/2;
			djsLayer.addChild(timer);

			LTweenLite.to(timer,0,{
				scaleX:1,
				scaleY:1,
				x:(640-timer.getWidth())/2,
				y:250+rmm.getHeight()/3-timer.getHeight()/2,
				ease:LEasing.easeOut
			}).to(timer,1,{
				scaleX:3,
				scaleY:3,
				alpha:0,
				x:(640-timer.getWidth()*3)/2,
				y:250+rmm.getHeight()/3-timer.getHeight()*3/2,
				ease:LEasing.easeOut,
				onComplete:function(){
					
				}
			});

			timernum--;
		}

		myTimer.addEventListener(LTimerEvent.TIMER_COMPLETE,function(){
			myTimer.stop();
			handLayer.addEventListener(LMouseEvent.MOUSE_DOWN,handdown);
			handLayer.addEventListener(LMouseEvent.MOUSE_UP,handup);
			djsTimer.start();
		});

		var djs=new LBitmap(new LBitmapData(imglist["djs"]));
		djs.x=(640-djs.getWidth())/2;
		djs.y=100;
		djsLayer.addChild(djs);

		djsTimer=new LTimer(10000/218,timeline);
		djsTimer.addEventListener(LTimerEvent.TIMER,djsline);
		function djsline(){
			var line = new LShape();
			djsLayer.addChild(line);
			line.graphics.drawRect(0, "#000000", [93, 152, linewidth, 22], true, "#880088");
			linewidth+=2;
		}

		djsTimer.addEventListener(LTimerEvent.TIMER_COMPLETE,page4);
	}
	function ajax_pm(){
		$.get("http://demo.heitao.com/hzgg/ajax_sub_num?test=test&num="+zhanum,function(data){
			// console.log(data);
			ranknum=data["rank"];
			zhatotal=data["all"];
			page4();
		},'JSON');
	}
	function handdown(){
		handLayer.removeAllChild();
		var hand2=new LBitmap(new LBitmapData(imglist["hand2"]));
		hand2.scaleX = scaleRate;
		hand2.scaleY = scaleRate;
		hand2.x=(640-hand2.getWidth())/2;
		hand2.y=640/ww*hh-hand2.getHeight()-40;
		handLayer.addChild(hand2);

		var rmmwz=new LBitmap(new LBitmapData(imglist["wz"+Math.round(Math.random()*6)]));
		rmmwz.x = (640-rmmwz.getWidth())/2;
		rmmwz.y = 430;
		rmmwzLayer.addChild(rmmwz);

		LTweenLite.to(rmmwz,0,{
			x:(640-rmmwz.getWidth())/2,
			y:430,
		}).to(rmmwz,0.3,{
			x:(640-rmmwz.getWidth())/2+300*Math.sin(Math.PI*Math.random()*2),
			y:430+300*Math.cos(Math.PI*Math.random()*2),
		}).to(rmmwz,0.05,{
			delay:0.5, 
			alpha:0
		});
		zharmmLayer.removeAllChild();
		var rmm;
		if(is_rmm){
			rmm=new LBitmap(new LBitmapData(imglist["rmm"+Math.round((Math.random())+2)]));
			rmmmusic.play();
		}else{
			zwmusic.play();
			rmm=new LBitmap(new LBitmapData(imglist["ziwei2"]));
		}
		
		rmm.scaleX = scaleRate;
		rmm.scaleY = scaleRate;
		rmm.x=(640-rmm.getWidth())/2;
		rmm.y=250;
		zharmmLayer.addChild(rmm);

	}
	function handup(){
		handLayer.removeAllChild();
		var hand1=new LBitmap(new LBitmapData(imglist["hand1"]));
		hand1.scaleX = scaleRate;
		hand1.scaleY = scaleRate;
		hand1.x=(640-hand1.getWidth())/2;
		hand1.y=640/ww*hh-hand1.getHeight()-40;
		handLayer.addChild(hand1);
		zhanum++;

		zharmmLayer.removeAllChild();
		var rmm;
		if(is_rmm){
			rmm=new LBitmap(new LBitmapData(imglist["rmm1"]));
			rmmmusic.play();
		}else{
			zwmusic.play();
			rmm=new LBitmap(new LBitmapData(imglist["ziwei1"]));
		}
		rmm.scaleX = scaleRate;
		rmm.scaleY = scaleRate;
		rmm.x=(640-rmm.getWidth())/2;
		rmm.y=250;
		zharmmLayer.addChild(rmm);
	}
	function page4(){
		djsTimer.removeEventListener(LTimerEvent.TIMER_COMPLETE,page4);
		handLayer.removeEventListener(LMouseEvent.MOUSE_DOWN,handdown);
		handLayer.removeEventListener(LMouseEvent.MOUSE_UP,handup);
		rmmwzLayer.removeAllChild();
		tanLayer.removeAllChild();
		
		var tanbg=new LSprite();
		tanLayer.addChild(tanbg);
		tanbg.graphics.drawRect(0,"#000",[0,0,640,1136],true,"#000");
		tanbg.alpha=0.8;

		var tan;
		var zharmmnum=new LTextField();
		var pxnum=new LTextField();
		var zharmmnumtotal=new LTextField();

		zharmmnum.text=zhanum;
		zharmmnum.size="40";
		zharmmnum.color="#e34848";

		pxnum.text=ranknum+"名";
		pxnum.size="40";
		pxnum.color="#e34848";

		zharmmnumtotal.text=zhatotal;
		zharmmnumtotal.size="40";
		zharmmnumtotal.color="#e34848";
		zharmmnumtotal.x=250-zharmmnumtotal.getWidth();
		zharmmnumtotal.y=510;
		// console.log(zharmmnumtotal.text);

		if(is_rmm){
			tan=new LBitmap(new LBitmapData(imglist["tan"]));
			tan.x=(640-tan.getWidth())/2;
			tan.y=300;
			tanLayer.addChild(tan);
			zharmmnum.x=360+(50-zharmmnum.getWidth())/2;
			zharmmnum.y=370;
			pxnum.x=330;
			pxnum.y=420;
			tanLayer.addChild(zharmmnumtotal);
		}else{
			tan=new LBitmap(new LBitmapData(imglist["tan1"]));
			tan.x=(640-tan.getWidth())/2;
			tan.y=300;
			tanLayer.addChild(tan);
			zharmmnum.x=410+(70-zharmmnum.getWidth())/2;
			zharmmnum.y=390;
			pxnum.x=320;
			pxnum.y=445;
			tanLayer.removeChild(zharmmnumtotal);
		}

		tanLayer.addChild(zharmmnum);

		tanLayer.addChild(pxnum);

		var tanbtn=new LSprite();
		tanLayer.addChild(tanbtn);
		var lqbtn=new LBitmap(new LBitmapData(imglist["lqbtn"]));
		lqbtn.x=(640-lqbtn.getWidth())/2;
		lqbtn.y=620;
		tanbtn.addChild(lqbtn);
		tanbtn.addEventListener(LMouseEvent.MOUSE_UP,lqlb);
	}
	function lqlb(){
		lbnum=parseInt(Math.random()*6)+1;
		tanLayer.removeAllChild();
		handLayer.removeAllChild();
		zharmmLayer.removeAllChild();
		djsLayer.removeAllChild();
		tanLayer.removeEventListener(LMouseEvent.MOUSE_UP,lqlb);

		zharmm.pause();
		lastmusic.play();

		var bg3=new LBitmap(new LBitmapData(imglist["bg3"]));
		backLayer.addChild(bg3);

		var logo1=new LBitmap(new LBitmapData(imglist["logo1"]));
		logo1.x=30;
		logo1.y=20;
		backLayer.addChild(logo1);

		var again_btn=new LBitmap(new LBitmapData(imglist["again_btn"]));
		again_btn.x=460;
		again_btn.y=40;
		againLayer.addChild(again_btn);

		var again_btn1=new LTextField();
		again_btn1.color="#000";
		again_btn1.size="26";
		if(is_rmm){
			again_btn1.text="我要扎紫薇";
		}else{
			again_btn1.text="我要扎嬷嬷";
		}
		again_btn1.x=460;
		again_btn1.y=90;
		againLayer.addChild(again_btn1);
		again_btn1.addEventListener(LMouseEvent.MOUSE_DOWN,zhaagain1);

		var pc=new LTextField();
		pc.text="进入官网";
		pc.color="#000";
		pc.size="30";
		pc.x=460;
		pc.y=LGlobal.height-80;
		backLayer.addChild(pc);
		pc.addEventListener(LMouseEvent.MOUSE_DOWN,function(){
			location.href="http://hz.muzhiyouwan.com";
		});
		var line3=new LSprite();
		line3.graphics.drawRect(0,"#000",[460,LGlobal.height-50,120,1],true,"#000");
		backLayer.addChild(line3);
		
		var gx=new LBitmap(new LBitmapData(imglist["gx"]));
		gx.x=120;
		gx.y=140;
		backLayer.addChild(gx);

		var lbtext=new LTextField();
		lbtext.text=lbtextarr[lbnum-1];
		lbtext.x=225;
		lbtext.y=190;
		lbtext.size="40";
		lbtext.weight="bolder";
		lbtext.color="#e34848";
		backLayer.addChild(lbtext);

		var bx=new LBitmap(new LBitmapData(imglist["bx"]));
		bx.x=90;
		bx.y=320;
		backLayer.addChild(bx);

		var lb=new LBitmap(new LBitmapData(imglist["lb"+lbnum]));
		lb.x=90;
		lb.y=320;
		backLayer.addChild(lb);

		addChild(inputLayer);
		inputLayer.graphics.drawRect(1,"#666666",[120, 680, 300, 50]);
		inputnum = new LTextField();
		inputnum.size="36";
		inputnum.color="#000";
		inputnum.setType(LTextFieldType.INPUT,inputLayer);
		backLayer.addChild(inputnum);
		inputnum.addEventListener(LFocusEvent.FOCUS_IN,onfocus);
		inputnum.addEventListener(LFocusEvent.FOCUS_OUT,outfocus);
		placeHolder=new LTextField();
		placeHolder.text="请输入手机号";
		placeHolder.size="36";
		placeHolder.color="#999";
		placeHolder.x=125;
		placeHolder.y=685;
		backLayer.addChild(placeHolder);

		sendLayer.graphics.drawRect(1,"#666",[0,0,100,50],true,"#e34848");
		sendLayer.x=420;
		sendLayer.y=680;
		backLayer.addChild(sendLayer);
		var sendbtn=new LTextField();
		sendbtn.text="确认";
		sendbtn.size="38";
		sendbtn.color="#fff";
		sendbtn.x=12;
		sendbtn.y=4;
		sendLayer.addChild(sendbtn);
		sendbtn.addEventListener(LMouseEvent.MOUSE_DOWN,sendnum);

		var sharebtn=new LBitmap(new LBitmapData(imglist["sharebtn"]));
		sharebtn.x=(640-sharebtn.getWidth())/2;
		sharebtn.y=760;
		sharebtnLayer.addChild(sharebtn);
		var sharebtntext=new LTextField();
		sharebtntext.text="邀请好友一起扎";
		sharebtntext.size="40";
		sharebtntext.color="#fff";
		sharebtntext.x=(640-sharebtntext.getWidth())/2;
		sharebtntext.y=775;
		sharebtnLayer.addChild(sharebtntext);
		sharebtnLayer.addEventListener(LMouseEvent.MOUSE_DOWN,sharepage);

		var rulebtn=new LTextField();
		rulebtn.text="奖励说明";
		rulebtn.color="#000";
		rulebtn.size="30";
		rulebtn.x=50;
		rulebtn.y=LGlobal.height-80;
		ruleLayer.addChild(rulebtn);
		var line1=new LSprite();
		line1.graphics.drawRect(0,"#000",[50,LGlobal.height-50,120,2],true,"#000");
		ruleLayer.addChild(line1);
		ruleLayer.addEventListener(LMouseEvent.MOUSE_DOWN,rulepage);

		var rankbtbn=new LTextField();
		rankbtbn.text="查看排行榜";
		rankbtbn.color="#000";
		rankbtbn.size="30";
		rankbtbn.x=240;
		rankbtbn.y=LGlobal.height-80;
		ranklistbtnLayer.addChild(rankbtbn);
		var line2=new LSprite();
		line2.graphics.drawRect(0,"#000",[240,LGlobal.height-50,150,2],true,"#000");
		ranklistbtnLayer.addChild(line2);
		ranklistbtnLayer.addEventListener(LMouseEvent.MOUSE_DOWN,ajax_rank);

		againLayer.addEventListener(LMouseEvent.MOUSE_DOWN,zhaagain);
	}
	function ajax_rank(){
		$.get("http://demo.heitao.com/hzgg/ajax_get_rank_list?test=test",function(data){
			console.log(data);
			userlist=data;
			console.log(userlist.length);
			rankpage();
		},'JSON');
	}
	function zhaagain1(){
		if(is_rmm){
			is_rmm=false;
		}else{
			is_rmm=true;
		}
		zhaagain();
	}
	function zhaagain(){
		myTimer.reset();
		djsTimer.reset();
		zhanum=0;
		linewidth=0;
		timernum=3;
		tanLayer.removeAllChild();
		backLayer.removeAllChild();
		againLayer.removeAllChild();
		sendLayer.removeAllChild();
		inputLayer.removeAllChild();
		sharebtnLayer.removeAllChild();
		ruleLayer.removeAllChild();
		ranklistbtnLayer.removeAllChild();
		removeChild(inputLayer);
		zharmmLayer.removeEventListener(LMouseEvent.MOUSE_UP,zhaagain);
		againLayer.removeEventListener(LMouseEvent.MOUSE_DOWN,zhaagain);
		zharmm.play();
		lastmusic.pause();
		page3();
	}
	function rulepage(){
		addChild(rulepageLayer);
		// ruleLayer.removeEventListener(LMouseEvent.MOUSE_DOWN,rulepage);
		var rulepagebg=new LBitmap(new LBitmapData(imglist["bg3"]));
		rulepageLayer.addChild(rulepagebg);

		var backbtn=new LBitmap(new LBitmapData(imglist["back"]));
		backbtn.x=500;
		backbtn.y=40;
		rulepageLayer.addChild(backbtn);

		var rulesTitle=new LTextField();
		rulesTitle.text="奖励说明";
		rulesTitle.weight="bolder";
		rulesTitle.size="40";
		rulesTitle.x=(640-rulesTitle.getWidth())/2;
		rulesTitle.y=100;
		rulepageLayer.addChild(rulesTitle);

		var rules=new LTextField();
		rules.setWordWrap(true,40);
		rules.htmlText='<font size="32"><p>1、参与资格：所有热心的勇士都可参与活动。</p>\
						<p>2、活动时间：4月6日至《还珠格格》正版手游公测前一天0点。</p>\
						<p>3、奖励规则：根据游戏内扎针的分数，勇士可获得不同价值的游戏公测礼包，勇士可进行重复测试，但是只发放最高价值的礼包奖励。</p>\
						<p>PS：排行前10名勇士获得价值888元的礼包。</p>\
						<p>4、发奖规则：对应的礼包奖励将在游戏上线当天通过手机号短信发送。</p>\
						<p>联系客服：4009611191</p></font>';
		rules.width=600;
		rules.x=20;
		rules.y=150;
		rulepageLayer.addChild(rules);
		rulepageLayer.addEventListener(LMouseEvent.MOUSE_DOWN,ruleup);
	}
	function rankpage(){
		addChild(ranklistLayer);
		// ruleLayer.removeEventListener(LMouseEvent.MOUSE_DOWN,rulepage);
		var rulepagebg=new LBitmap(new LBitmapData(imglist["bg3"]));
		ranklistLayer.addChild(rulepagebg);

		var backbtn=new LBitmap(new LBitmapData(imglist["back"]));
		backbtn.x=500;
		backbtn.y=40;
		ranklistLayer.addChild(backbtn);

		var rulesTitle=new LTextField();
		rulesTitle.text="排行榜";
		rulesTitle.weight="bolder";
		rulesTitle.size="40";
		rulesTitle.x=(640-rulesTitle.getWidth())/2;
		rulesTitle.y=100;
		ranklistLayer.addChild(rulesTitle);

		var pm_title=new LBitmap(new LBitmapData(imglist["pm_title"]));
		pm_title.x=0;
		pm_title.y=170;
		ranklistLayer.addChild(pm_title);

		var userpath=[];
    	for(var i=0;i<userlist.length;i++){
    		var aa=new Object();
    		aa.name="name"+i;
    		if(userlist[i]["headimgurl"]==""){
    			aa.path="img/com_head.png";
    		}else{
    			aa.path=userlist[i]["headimgurl"];
    		}
    		
    		userpath.push(aa);
    	}
    	console.log(userpath);
    	LLoadManage.load(userpath,
		function (progress) {
		    // loadingLayer.setProgress(progress);
		}, user);
    	


		ranklistLayer.addEventListener(LMouseEvent.MOUSE_DOWN,rankup);
	}
	function user(result){
		for(var i=0;i<userlist.length;i++){
			var userheadimg=new LBitmapData(result["name"+i]);
    		var userheadbox = new LBitmap(userheadimg);
    		console.log(userheadbox.getWidth(),userheadbox.getHeight());
		    userheadbox.x=140;
		    userheadbox.y=240+110*i;
		    userheadbox.scaleX=80/userheadbox.getWidth();
		    userheadbox.scaleY=80/userheadbox.getHeight();
		    ranklistLayer.addChild(userheadbox);
		    var maskObj = new LSprite();
		    maskObj.x=180;
		    maskObj.y=280+110*i;
		    maskObj.graphics.drawArc(1,"#000",[0,0,40,0,Math.PI*2]);
		    userheadbox.mask = maskObj;
		    
			var username=new LTextField();
			username.text=userlist[i]["nickname"];
			username.size="30";
			username.color="#000";
			username.width=200;
			username.x=250;
			username.y=265+110*i;
			ranklistLayer.addChild(username);

			var userscore=new LTextField();
			userscore.text=userlist[i]["num"];
			userscore.size="30";
			userscore.color="#000";
			userscore.width=200;
			userscore.x=560;
			userscore.y=270+110*i;
			ranklistLayer.addChild(userscore);

			var listline=new LSprite();
			listline.graphics.drawRect(0,"#000",[0,335+110*i,640,1],true,"#999");
			ranklistLayer.addChild(listline);

			if(i<3){
				var pm=new LBitmap(new LBitmapData(imglist["no"+(i+1)]));
				pm.x=30;
				pm.y=240+110*i;
				ranklistLayer.addChild(pm);
			}else{
				var pm=new LTextField();
				pm.text=i+1;
				pm.color="#000";
				pm.size="30";
				pm.x=45;
				pm.y=265+110*i;
				ranklistLayer.addChild(pm);
			}
    	}
	}
	function rankup(){
		ranklistLayer.removeEventListener(LMouseEvent.MOUSE_DOWN,rankup);
		removeChild(ranklistLayer);
	}
	function ruleup(){
		rulepageLayer.removeEventListener(LMouseEvent.MOUSE_DOWN,ruleup);
		removeChild(rulepageLayer);
	}
	function onfocus(){
		backLayer.removeChild(placeHolder);
	}
	function outfocus(){
		if(inputnum.text.length==0){
			backLayer.addChild(placeHolder);
		}
	}
	function sendnum(){
		sendbtn.removeEventListener(LMouseEvent.MOUSE_DOWN,sendnum);
		var phonenumber=inputnum.text;
		console.log(phonenumber);
		validatemobile(phonenumber);
	}
	function validatemobile(mobile){ 
		if(mobile.length==0){ 
		  alert('请输入手机号码！'); 
		  return false; 
		}
		if(mobile.length!=11){ 
		   alert('请输入有效的手机号码！'); 
		   return false; 
		} 
		var myreg = /^((1[0-9]{1})+\d{9})$/; 
		if(!myreg.test(mobile)){ 
		   alert('请输入有效的手机号码！'); 
		   return false; 
		} 
	} 
	function sharepage(){
		addChild(sharepageLayer);
		sharebtnLayer.addEventListener(LMouseEvent.MOUSE_DOWN,sharepage);
		sharepageLayer.graphics.drawRect(0,"#000",[0,0,640,1136],true,"#000");
		sharepageLayer.alpha=0.8;
		var share=new LBitmap(new LBitmapData(imglist["share"]));
		share.x=230;
		share.y=30;
		sharepageLayer.addChild(share);
		sharepageLayer.addEventListener(LMouseEvent.MOUSE_DOWN,shareup);
	}
	function shareup(){
		sharepageLayer.removeEventListener(LMouseEvent.MOUSE_DOWN,shareup);
		removeChild(sharepageLayer);
	}
